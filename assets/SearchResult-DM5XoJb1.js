import{g as V,u as X,h as M,i as Z,j as ee,t as se,k as te,l as Q,m as F,n as t,p as le,w as ae,q as ue,R as L,v as ie,x as re,y as oe,z as ne,A as ce,B as I,C as $,D as Ee,E as me,F as he,G as ve,H as de,I as Ae,J as Be,K as pe,L as j,M as ye,N as _}from"./app-CF8y_6Vc.js";const Ce=["/Example.html","/Home.html","/","/assets_/WolframAlpha.html","/assets_/%E5%85%AC%E5%BC%8F%E7%BC%96%E8%BE%91%E5%99%A8.html","/assets_/%E8%8D%89%E7%A8%BF.html","/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/-%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0-.html","/assets_/Callouts/Callouts-Abstract.html","/assets_/Callouts/Callouts-Bug.html","/assets_/Callouts/Callouts-ChatGPT.html","/assets_/Callouts/Callouts-Danger.html","/assets_/Callouts/Callouts-Example.html","/assets_/Callouts/Callouts-Failure.html","/assets_/Callouts/Callouts-Info.html","/assets_/Callouts/Callouts-Note.html","/assets_/Callouts/Callouts-Question.html","/assets_/Callouts/Callouts-Quote.html","/assets_/Callouts/Callouts-Success.html","/assets_/Callouts/Callouts-Tips.html","/assets_/Callouts/Callouts-Todo.html","/assets_/Callouts/Callouts-Warning.html","/assets_/Callouts/Callouts%E8%AF%AD%E6%B3%95.html","/assets_/Template/template-default.html","/assets_/Template/template-todo.html","/assets_/Template/template-%E5%A4%8D%E5%88%86%E6%9E%90.html","/assets_/Template/template-%E5%BE%AE%E7%A7%AF%E5%88%86.html","/assets_/Template/template-%E6%A6%82%E7%8E%87%E8%AE%BA.html","/assets_/Template/template-%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0.html","/assets_/dataview%E6%9F%A5%E8%AF%A2/%E5%85%AC%E5%BC%8F.html","/assets_/dataview%E6%9F%A5%E8%AF%A2/%E6%9D%B1%E5%B7%A5%E9%81%8E%E5%8E%BB%E5%95%8F.html","/assets_/dataview%E6%9F%A5%E8%AF%A2/%E7%A9%BA%E5%B1%9E%E6%80%A7%E6%A3%80%E7%B4%A2.html","/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/%E8%A1%8C%E5%88%97%E5%BC%8F/--%E8%A1%8C%E5%88%97%E5%BC%8F--.html","/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/%E8%A1%8C%E5%88%97%E5%BC%8F/%E6%8B%89%E6%99%AE%E6%8B%89%E6%96%AF%E5%B1%95%E5%BC%80%E6%B3%95.html","/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/%E8%A1%8C%E5%88%97%E5%BC%8F/%E8%A1%8C%E5%88%97%E5%BC%8F.html","/404.html","/assets_/","/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/","/assets_/Callouts/","/assets_/Template/","/assets_/dataview%E6%9F%A5%E8%AF%A2/","/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/%E8%A1%8C%E5%88%97%E5%BC%8F/","/category/","/tag/","/tag/%E6%95%B0%E5%AD%A6/","/tag/%E5%B7%A5%E5%85%B7/","/tag/todo/","/tag/dataview/","/Blog/","/star/","/timeline/"],ge="SLIMSEARCH_QUERY_HISTORY",A=j(ge,[]),Fe=()=>{const{queryHistoryCount:a}=_;return{enabled:a>0,queryHistories:A,addQueryHistory:r=>{A.value=Array.from(new Set([r,...A.value.slice(0,a-1)]))},removeQueryHistory:r=>{A.value=[...A.value.slice(0,r),...A.value.slice(r+1)]}}},T=a=>Ce[a.id]+("anchor"in a?`#${a.anchor}`:""),_e="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:b}=_,B=j(_e,[]),fe=()=>({enabled:b>0,resultHistories:B,addResultHistory:i=>{{const r={link:T(i),display:i.display};"header"in i&&(r.header=i.header),B.value=[r,...B.value.slice(0,b-1)]}},removeResultHistory:i=>{B.value=[...B.value.slice(0,i),...B.value.slice(i+1)]}}),He=a=>{const i=Ee(),r=M(),f=me(),o=Q(0),p=F(()=>o.value>0),E=he([]);return ve(()=>{const{search:H,terminate:h}=de(),y=Be(v=>{const{resultsFilter:w=l=>l,querySplitter:d,suggestionsFilter:q,...u}=i.value;v?(o.value+=1,H(v,r.value,u).then(l=>w(l,v,r.value,f.value)).then(l=>{o.value-=1,E.value=l}).catch(l=>{console.warn(l),o.value-=1,o.value||(E.value=[])})):E.value=[]},_.searchDelay-_.suggestDelay,{maxWait:5e3});Ae([a,r],([v])=>y(v.join(" "))),pe(()=>{h()})}),{isSearching:p,results:E}};var Re=V({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(a,{emit:i}){const r=X(),f=M(),o=Z(ee),{addQueryHistory:p,queryHistories:E,removeQueryHistory:H}=Fe(),{resultHistories:h,addResultHistory:y,removeResultHistory:v}=fe(),w=se(a,"queries"),{results:d,isSearching:q}=He(w),u=te({isQuery:!0,index:0}),l=Q(0),m=Q(0),D=F(()=>E.value.length>0||h.value.length>0),R=F(()=>d.value.length>0),k=F(()=>d.value[l.value]||null),P=()=>{const{isQuery:e,index:s}=u;s===0?(u.isQuery=!e,u.index=e?h.value.length-1:E.value.length-1):u.index=s-1},U=()=>{const{isQuery:e,index:s}=u;s===(e?E.value.length-1:h.value.length-1)?(u.isQuery=!e,u.index=0):u.index=s+1},O=()=>{l.value=l.value>0?l.value-1:d.value.length-1,m.value=k.value.contents.length-1},W=()=>{l.value=l.value<d.value.length-1?l.value+1:0,m.value=0},Y=()=>{m.value<k.value.contents.length-1?m.value+=1:W()},G=()=>{m.value>0?m.value-=1:O()},x=e=>e.map(s=>ye(s)?s:t(s[0],s[1])),N=e=>{if(e.type==="customField"){const s=ne[e.index]||"$content",[n,g=""]=ce(s)?s[f.value].split("$content"):s.split("$content");return e.display.map(c=>t("div",x([n,...c,g])))}return e.display.map(s=>t("div",x(s)))},C=()=>{l.value=0,m.value=0,i("updateQuery",""),i("close")},z=()=>t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},o.value.queryHistory),E.value.map((e,s)=>t("div",{class:["slimsearch-result-item",{active:u.isQuery&&u.index===s}],onClick:()=>{i("updateQuery",e)}},[t(I,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},e),t("button",{class:"slimsearch-remove-icon",innerHTML:$,onClick:n=>{n.preventDefault(),n.stopPropagation(),H(s)}})]))])),J=()=>t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},o.value.resultHistory),h.value.map((e,s)=>t(L,{to:e.link,class:["slimsearch-result-item",{active:!u.isQuery&&u.index===s}],onClick:()=>{C()}},()=>[t(I,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[e.header?t("div",{class:"content-header"},e.header):null,t("div",e.display.map(n=>x(n)).flat())]),t("button",{class:"slimsearch-remove-icon",innerHTML:$,onClick:n=>{n.preventDefault(),n.stopPropagation(),v(s)}})]))]));return le("keydown",e=>{if(a.isFocusing){if(R.value){if(e.key==="ArrowUp")G();else if(e.key==="ArrowDown")Y();else if(e.key==="Enter"){const s=k.value.contents[m.value];p(a.queries.join(" ")),y(s),r.push(T(s)),C()}}else if(e.key==="ArrowUp")P();else if(e.key==="ArrowDown")U();else if(e.key==="Enter"){const{index:s}=u;u.isQuery?(i("updateQuery",E.value[s]),e.preventDefault()):(r.push(h.value[s].link),C())}}}),ae([l,m],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["slimsearch-result-wrapper",{empty:a.queries.length?!R.value:!D.value}],id:"slimsearch-results"},a.queries.length?q.value?t(ue,{hint:o.value.searching}):R.value?t("ul",{class:"slimsearch-result-list"},d.value.map(({title:e,contents:s},n)=>{const g=l.value===n;return t("li",{class:["slimsearch-result-list-item",{active:g}]},[t("div",{class:"slimsearch-result-title"},e||o.value.defaultTitle),s.map((c,K)=>{const S=g&&m.value===K;return t(L,{to:T(c),class:["slimsearch-result-item",{active:S,"aria-selected":S}],onClick:()=>{p(a.queries.join(" ")),y(c),C()}},()=>[c.type==="text"?null:t(c.type==="title"?ie:c.type==="heading"?re:oe,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[c.type==="text"&&c.header?t("div",{class:"content-header"},c.header):null,t("div",N(c))])])})])})):o.value.emptyResult:D.value?[z(),J()]:o.value.emptyHistory)}});export{Re as default};
